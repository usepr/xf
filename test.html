<html>
<script>

// 定义watch方法
if (!Object.prototype.watch) {
	Object.defineProperty(Object.prototype, "watch", {
		enumerable: false, 
		configurable: true, 
		writable: false, 
		value: function (prop, handler) {
			var oldval = this[prop], 
			newval = oldval, 
			getter = function () {
				return newval;
			}, 
			setter = function (val) {
				oldval = newval;
				return newval = handler.call(this, prop, oldval, val);
			};

			if (delete this[prop]) { // can't watch constants
				Object.defineProperty(this, prop, {
					get: getter,
					set: setter, 
					enumerable: true,
					configurable: true
				});
			}
		}
	});
}
	
// document对象监听domain属性变化
document.watch("domain", function(propname, oldurl, newurl){
	console.log("proxy: " + newurl);
});

// 业务代码无需修改
document.domain = "abc.com";

var doc = document;
var dm = 'domain';
doc[dm] = "xyz.com";	// 不管怎么隐藏都可以代理
</script>
</html>
